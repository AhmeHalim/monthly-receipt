<style>
    @media print {
        @page {
            size: A4;
            margin: 5mm;
        }

        body {
            margin: 0;
            padding: 0;
            background: white !important;
            font-size: 14px;
        }

        .receipt-grid {
            display: grid !important;
            grid-template-columns: repeat(2, 1fr) !important;
            grid-template-rows: repeat(2, 1fr) !important;
            gap: 10mm !important;
            width: 190mm !important;
            height: 277mm !important;
            page-break-after: always;
            margin: 0 !important;
            padding: 0 !important;
        }

        .receipt {
            width: 90mm !important;
            height: 130mm !important;
            margin: 0 !important;
            padding: 5mm !important;
            border: 2px solid #000 !important;
            break-inside: avoid;
            page-break-inside: avoid;
        }

        .receipt-header {
            padding: 3mm !important;
            margin: -5mm -5mm 5mm -5mm !important;
        }

        .receipt-title {
            font-size: 18px !important;
        }

        .receipt-number {
            font-size: 16px !important;
        }

        .field {
            padding: 3mm !important;
            margin: 2mm 0 !important;
            font-size: 14px !important;
        }

        .amount-field {
            padding: 4mm !important;
            font-size: 16px !important;
        }

        .receipt-footer {
            padding: 3mm !important;
            margin: 5mm -5mm -5mm -5mm !important;
            font-size: 12px !important;
        }
    }
</style>

<script>
    async function downloadPDF() {
        const container = document.getElementById('receiptsContainer');
        if (!container || !container.children.length) {
            showStatus('يرجى إنشاء الإيصالات أولاً!', 'info');
            return;
        }

        showStatus('جاري إنشاء ملف PDF...', 'info');

        try {
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');
            const pages = container.querySelectorAll('.receipt-grid');

            for (let i = 0; i < pages.length; i++) {
                if (i > 0) pdf.addPage();
                
                const page = pages[i];
                const canvas = await html2canvas(page, {
                    scale: 2,
                    logging: false,
                    useCORS: true,
                    backgroundColor: '#ffffff',
                    width: 210,
                    height: 297
                });

                const imgData = canvas.toDataURL('image/jpeg', 1.0);
                pdf.addImage(imgData, 'JPEG', 0, 0, 210, 297);
            }

            const fileName = `إيصالات_اتحاد_الملاك_${document.getElementById('monthInput').value}_${document.getElementById('yearInput').value}.pdf`;
            pdf.save(fileName);
            showStatus('تم إنشاء PDF بنجاح!', 'success');
        } catch (error) {
            console.error('Error generating PDF:', error);
            showStatus('حدث خطأ أثناء إنشاء PDF', 'error');
        }
    }
</script>
